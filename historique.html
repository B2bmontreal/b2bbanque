<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Historique de Transactions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
    <style>
      body {
        font-family: 'Roboto', sans-serif;
      }
    </style>
  </head>
  <body class="bg-blue-900">
    <div class="container mx-auto p-4">
      <header class="bg-blue-800 text-white p-4 flex justify-between items-center">
        <div class="flex items-center">
          <img alt="Banque Laurentienne logo" class="mr-4" height="50" src="images/logob2b.png" width="50"/>
          <h1 class="text-xl font-bold">B2B BANQUE</h1>
        </div>
        <nav class="space-x-4">
          <a class="text-yellow-400" href="#">MES COMPTES</a>
          <a class="text-white" href="#">PAIEMENTS DE FACTURES</a>
          <a class="text-white" href="#">VIREMENTS</a>
          <a class="text-white" href="#">DEMANDES</a>
          <a class="text-white" href="#">MESSAGES</a>
          <a class="text-white" href="#">MON PROFIL</a>
        </nav>
      </header>

      <div class="flex mt-4">
        <aside class="w-1/4 bg-blue-700 text-white p-4">
          <p class="mb-4">Bienvenue PASCALINE TRIBALLIER</p>
          <div class="bg-yellow-500 p-2 mb-4">
            <h2 class="font-bold">MES COMPTES</h2>
          </div>
          <ul>
            <li class="mb-2"><a class="block p-2 bg-blue-600" href="#">Sommaire</a></li>
            <li class="mb-2"><a class="block p-2 bg-blue-600" href="#">Historique de transactions</a></li>
            <li class="mb-2"><a class="block p-2 bg-blue-600" href="#">Accès Investissements</a></li>
          </ul>
        </aside>

        <main class="w-3/4 bg-white p-4">
          <h2 class="bg-yellow-500 p-2 font-bold">HISTORIQUE DE TRANSACTIONS</h2>
          <p class="mt-4">Certains produits offrent un historique inférieur à 24 mois. Dans ce cas, toutes les données disponibles sont affichées.</p>
          <p class="mt-2 font-bold text-xl">Solde <span class="text-black" id="balance">Chargement...</span></p>
          <a class="text-blue-500" href="#">Plus d'information sur ce compte</a>

          <!-- Historique des transactions -->
          <div class="mt-4">
            <h3 class="font-bold">Historique des Transactions</h3>
            <ul id="transaction-history" class="mt-2 space-y-2"></ul>
          </div>
        </main>
      </div>
    </div>

    <script>
      // Récupérer le solde
      function updateBalance() {
        fetch('http://localhost:3000/solde')
          .then(response => response.json())
          .then(data => {
            document.getElementById('balance').textContent = `${data.balance.toLocaleString()} $`;
          })
          .catch(error => console.error('Erreur lors de la récupération du solde', error));
      }

      // Charger l'historique des transactions depuis le serveur
      function loadTransactionHistory() {
        fetch('http://localhost:3000/historique')
          .then(response => response.json())
          .then(transactions => {
            const historyList = document.getElementById('transaction-history');
            historyList.innerHTML = '';  // Effacer l'historique existant

            if (transactions.length > 0) {
              transactions.forEach(transaction => {
                const li = document.createElement('li');
                li.classList.add('bg-gray-100', 'p-4', 'rounded', 'shadow');
                li.innerHTML = `
                  <p><strong>${transaction.date}</strong> - ${transaction.amount} EUR</p>
                  <p>Beneficiary: ${transaction.beneficiary}</p>
                  <p>Reason: ${transaction.reason}</p>
                `;
                historyList.appendChild(li);
              });
            } else {
              historyList.innerHTML = '<li>Aucune transaction enregistrée.</li>';
            }
          })
          .catch(error => console.error('Erreur lors de la récupération de l\'historique', error));
      }

      // Charger les données à l'initialisation
      window.onload = function() {
        updateBalance();
        loadTransactionHistory();
      };
    </script>
  </body>
</html>
